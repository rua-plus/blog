```
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.
```

## 项目概述

这是一个博客系统的后端项目，使用 PostgreSQL 18 作为数据库，提供用户认证、文章管理、评论管理等功能。

## 核心架构

### 数据库设计

项目包含以下 6 个核心表：

1. **users** - 用户表：存储用户信息，支持 JWT 认证
2. **posts** - 文章表：存储文章内容，支持草稿、发布、归档状态
3. **categories** - 分类表：存储文章分类，支持多级分类
4. **comments** - 评论表：存储文章评论，支持嵌套回复和匿名评论
5. **tags** - 标签表：存储文章标签
6. **media** - 媒体表：存储上传的媒体文件

SQL 初始化脚本位于 `sql/init.sql`，包含完整的表结构、索引和触发器定义。

### 接口设计

统一的响应格式定义在 `interface.ts` 中，包含：

- **成功响应**：包含 `success: true`、业务数据和可选版本信息
- **错误响应**：包含 `success: false`、错误码、错误信息和可选调试信息
- **分页响应**：包含数据列表和分页信息

#### 状态码系统

使用 5 位数字状态码：
- `2xxx` - 成功状态码
- `400xx` - 客户端错误（参数验证、请求错误等）
- `401xx` - 认证错误（未授权、 token 过期等）
- `403xx` - 权限错误（禁止访问、权限不足等）
- `404xx` - 资源错误（未找到）
- `409xx` - 业务逻辑错误（冲突、重复资源等）
- `500xx` - 系统错误（内部错误、数据库错误等）
- `502xx` - 第三方服务错误

### 安全特性

- **密码哈希**：使用 Argon2id 算法， fallback 到 scrypt、bcrypt 或 PBKDF2
- **认证**：JWT（JSON Web Token）
- **数据验证**：严格的字段验证和约束

## 文件结构

```
├── interface.ts      # TypeScript 接口定义
├── README.md         # 项目文档
└── sql/
    └── init.sql      # 数据库初始化脚本
```

## 开发命令

当前项目没有提供具体的构建或测试命令，因为这是一个架构设计阶段的项目。

## 关键文件说明

### interface.ts
- 定义了完整的状态码枚举 `StatusCode`
- 定义了统一的响应接口类型（成功、错误、分页响应）
- 包含分页信息接口 `PaginationInfo`

### sql/init.sql
- 包含所有表的创建语句和字段定义
- 配置了外键约束和索引
- 实现了 `updated_at` 字段的自动更新触发器
- 包含数据验证约束（如文章发布状态与发布时间的关联）

### README.md
- 详细描述了项目的数据库设计和后端设计理念
- 包含接口响应格式示例
- 说明了解密哈希算法的使用策略
